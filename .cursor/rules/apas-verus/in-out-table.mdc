---
description: Format for auditing code inside vs outside verus! blocks
globs: "**/*.rs"
alwaysApply: true
---

# In/Out Table

When the user says "in-out table" or "in/out table", audit what code is inside vs outside `verus!` blocks and produce the table below.

## Format

| # | Chapter | File | Clone | PartialEq/Eq | Default | Drop | Iterator | Debug | Display | Macro | Other |
|---|---------|------|:-----:|:------------:|:-------:|:----:|:--------:|:-----:|:-------:|:-----:|-------|

## Column Values

- `✅ in` = correctly inside `verus!`
- `✅ out` = correctly outside `verus!` (required — Verus limitation)
- `❌ in` = incorrectly inside (should be outside)
- `❌ out` = incorrectly outside (should be inside)
- `-` = not implemented

## What Goes Inside verus!

These trait impls CAN and SHOULD be inside `verus!` with specifications:

- **Clone** — with `ensures cloned@ == self@` if possible
- **PartialEq / Eq** — per `partialeq-eq-pattern.mdc` (PartialEqSpecImpl + ensures + assume)
- **Default** — delegates to `new()`, no `external_body` needed
- **Drop** — requires `#[verifier::external_body]`, `opens_invariants none`, `no_unwind`
- **Iterator infrastructure** — custom iter struct, View, iter_invariant, Iterator::next,
  ghost iter struct, ForLoopGhostIteratorNew, ForLoopGhostIterator, IntoIterator for &Self,
  IntoIterator for Self, iter() method

## What Must Stay Outside verus!

- **Debug / Display** — Verus does not support fmt traits
- **`macro_rules!`** — macros are expanded before verification
- **Unsafe marker traits** — `Sync`, `Send`
- **`&mut`-returning methods** — `iter_mut()`, `IntoIterator for &mut Self`
- **`#[cfg(...)]` stubs** — compatibility code for non-Verus builds
